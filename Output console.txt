Started by GitHub push by tomernos
Lightweight checkout support not available, falling back to full checkout.
Checking out git https://github.com/tomernos/python-projects into /var/lib/jenkins/workspace/FlaskRDS@script/c897bff1ceefdd1b7f8978399a3128100787361fb91d57dfa6def1f993a56825 to read Jenkinsfile
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential git-credentials
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/FlaskRDS@script/c897bff1ceefdd1b7f8978399a3128100787361fb91d57dfa6def1f993a56825/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/tomernos/python-projects # timeout=10
Fetching upstream changes from https://github.com/tomernos/python-projects
 > git --version # timeout=10
 > git --version # 'git version 2.40.1'
using GIT_ASKPASS to set credentials GitHub Credentials
 > git fetch --tags --force --progress -- https://github.com/tomernos/python-projects +refs/heads/*:refs/remotes/origin/* # timeout=10
Seen branch in repository origin/feature/pgrds
Seen branch in repository origin/main
Seen 2 remote branches
 > git show-ref --tags -d # timeout=10
Checking out Revision e721c4635cdf877eed2adeeae9363f38610664ab (origin/feature/pgrds)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f e721c4635cdf877eed2adeeae9363f38610664ab # timeout=10
Commit message: "Implement new feature"
 > git rev-list --no-walk c61f1f895b558c8545a4a0a255237bd2591e4a44 # timeout=10
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/lib/jenkins/workspace/FlaskRDS
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential git-credentials
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/FlaskRDS/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/tomernos/python-projects # timeout=10
Fetching upstream changes from https://github.com/tomernos/python-projects
 > git --version # timeout=10
 > git --version # 'git version 2.40.1'
using GIT_ASKPASS to set credentials GitHub Credentials
 > git fetch --tags --force --progress -- https://github.com/tomernos/python-projects +refs/heads/*:refs/remotes/origin/* # timeout=10
Seen branch in repository origin/feature/pgrds
Seen branch in repository origin/main
Seen 2 remote branches
 > git show-ref --tags -d # timeout=10
Checking out Revision e721c4635cdf877eed2adeeae9363f38610664ab (origin/feature/pgrds)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f e721c4635cdf877eed2adeeae9363f38610664ab # timeout=10
Commit message: "Implement new feature"
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] withCredentials
Masking supported pattern matches of $DB_CREDENTIALS or $DB_CREDENTIALS_PSW or $GIT_CREDENTIALS or $GIT_CREDENTIALS_PSW
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Setup)
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ sudo command -v docker
[Pipeline] sh
+ sudo command -v docker-compose
[Pipeline] sh
+ sudo command -v python3
[Pipeline] sh
+ sudo command -v git
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Checkout)
[Pipeline] script
[Pipeline] {
[Pipeline] git
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential git-credentials
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/FlaskRDS/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/tomernos/python-projects.git # timeout=10
Fetching upstream changes from https://github.com/tomernos/python-projects.git
 > git --version # timeout=10
 > git --version # 'git version 2.40.1'
using GIT_ASKPASS to set credentials GitHub Credentials
 > git fetch --tags --force --progress -- https://github.com/tomernos/python-projects.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/feature/pgrds^{commit} # timeout=10
Checking out Revision e721c4635cdf877eed2adeeae9363f38610664ab (refs/remotes/origin/feature/pgrds)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f e721c4635cdf877eed2adeeae9363f38610664ab # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git branch -D feature/pgrds # timeout=10
 > git checkout -b feature/pgrds e721c4635cdf877eed2adeeae9363f38610664ab # timeout=10
Commit message: "Implement new feature"
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build)
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ sudo docker-compose build
time="2024-08-29T10:42:09Z" level=warning msg="The \"DB_USER\" variable is not set. Defaulting to a blank string."
time="2024-08-29T10:42:09Z" level=warning msg="The \"DB_PASSWORD\" variable is not set. Defaulting to a blank string."
time="2024-08-29T10:42:09Z" level=warning msg="The \"DB_HOST\" variable is not set. Defaulting to a blank string."
time="2024-08-29T10:42:09Z" level=warning msg="The \"DB_NAME\" variable is not set. Defaulting to a blank string."
#1 [flask-app internal] load build definition from Dockerfile
#1 transferring dockerfile: 329B 0.0s done
#1 DONE 0.1s

#2 [flask-app internal] load metadata for docker.io/library/python:3.9-slim
#2 DONE 0.5s

#3 [flask-app internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [flask-app 1/6] FROM docker.io/library/python:3.9-slim@sha256:1e3437daae1d9cebce372794eacfac254dd108200e47c8b7f56a633ebd3e2a0a
#4 DONE 0.0s

#5 [flask-app internal] load build context
#5 transferring context: 473.35kB 0.5s done
#5 DONE 0.6s

#6 [flask-app 2/6] WORKDIR /app
#6 CACHED

#7 [flask-app 3/6] RUN apt-get update && apt-get install -y libpq-dev gcc
#7 CACHED

#8 [flask-app 4/6] COPY requirements.txt requirements.txt
#8 CACHED

#9 [flask-app 5/6] RUN pip3 install -r requirements.txt
#9 CACHED

#10 [flask-app 6/6] COPY . .
#10 DONE 4.5s

#11 [flask-app] exporting to image
#11 exporting layers
#11 exporting layers 2.6s done
#11 writing image sha256:06c9a4f21d7ec8495e5ea0423c0e68ab077b24009a39027551a9074fc3feb764
#11 writing image sha256:06c9a4f21d7ec8495e5ea0423c0e68ab077b24009a39027551a9074fc3feb764 0.0s done
#11 naming to docker.io/library/flaskrds-flask-app 0.0s done
#11 DONE 2.6s
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Check Environment)
[Pipeline] sh
++ whoami
+ echo 'User: jenkins'
User: jenkins
+ echo 'Python Version:'
Python Version:
+ python3 --version
Python 3.9.16
+ echo 'Python Path:'
Python Path:
+ which python3
/usr/bin/python3
+ echo 'Pip List:'
Pip List:
+ pip list
Package              Version
-------------------- --------
attrs                20.3.0
aws-cfn-bootstrap    2.0
awscli               2.15.30
awscrt               0.19.19
Babel                2.9.1
certifi              2024.7.4
cffi                 1.14.5
chardet              4.0.0
charset-normalizer   3.3.2
chevron              0.13.1
cloud-init           22.2.2
colorama             0.4.4
configobj            5.0.6
cryptography         36.0.1
dbus-python          1.2.18
distro               1.5.0
docker               7.1.0
docutils             0.16
ec2-hibinit-agent    1.0.8
gpg                  1.15.1
idna                 3.7
Jinja2               2.11.3
jmespath             0.10.0
jsonpatch            1.21
jsonpointer          2.0
jsonschema           3.2.0
libcomps             0.1.20
lockfile             0.12.2
MarkupSafe           1.1.1
netifaces            0.10.6
oauthlib             3.0.2
pip                  21.3.1
ply                  3.11
prettytable          0.7.2
prompt-toolkit       3.0.24
pycparser            2.20
pyrsistent           0.17.3
pyserial             3.4
PySocks              1.7.1
python-daemon        2.3.0
python-dateutil      2.8.1
pytz                 2022.7.1
PyYAML               5.4.1
release-notification 1.2
requests             2.32.3
rpm                  4.16.1.3
ruamel.yaml          0.16.6
ruamel.yaml.clib     0.1.2
selinux              3.4
sepolicy             3.4
setools              4.4.1
setuptools           59.6.0
six                  1.15.0
support-info         1.0
systemd-python       235
urllib3              2.2.2
wcwidth              0.2.5
+ echo 'Environment Variables:'
Environment Variables:
+ env
SHELL=/bin/bash
RUN_TESTS_DISPLAY_URL=http://54.86.181.124:8080/job/FlaskRDS/12/display/redirect?page=tests
DB_CREDENTIALS_USR=flaskadmin
JENKINS_SERVER_COOKIE=durable-015d9192994f03d2b31bf3840afab5a3607d461b91f8f4799932ec018d8f4469
RUN_CHANGES_DISPLAY_URL=http://54.86.181.124:8080/job/FlaskRDS/12/display/redirect?page=changes
HUDSON_HOME=/var/lib/jenkins
PWD=/var/lib/jenkins/workspace/FlaskRDS
LOGNAME=jenkins
BUILD_URL=http://54.86.181.124:8080/job/FlaskRDS/12/
JOB_URL=http://54.86.181.124:8080/job/FlaskRDS/
BUILD_NUMBER=12
SYSTEMD_EXEC_PID=14272
DB_PORT=5432
JENKINS_NODE_COOKIE=c664d9a9-29a0-4be7-9a4c-31c091e60f51
BUILD_DISPLAY_NAME=#12
HOME=/var/lib/jenkins
LANG=C.UTF-8
JENKINS_URL=http://54.86.181.124:8080/
JOB_BASE_NAME=FlaskRDS
JOB_NAME=FlaskRDS
INVOCATION_ID=b264cd0cdf5e4e728f76c209f676a03f
RUN_DISPLAY_URL=http://54.86.181.124:8080/job/FlaskRDS/12/display/redirect
JOB_DISPLAY_URL=http://54.86.181.124:8080/job/FlaskRDS/display/redirect
WORKSPACE=/var/lib/jenkins/workspace/FlaskRDS
GIT_CREDENTIALS_PSW=****
GIT_CREDENTIALS=****
GIT_PREVIOUS_COMMIT=c61f1f895b558c8545a4a0a255237bd2591e4a44
HUDSON_URL=http://54.86.181.124:8080/
NODE_NAME=built-in
DB_HOST=flask-app-postgres-db.cn4wyakgw2cz.us-east-1.rds.amazonaws.com
USER=jenkins
HUDSON_SERVER_COOKIE=c59a91245f7496f4
NOTIFY_SOCKET=/run/systemd/notify
GIT_URL=https://github.com/tomernos/python-projects
SHLVL=2
BUILD_TAG=jenkins-FlaskRDS-12
EXECUTOR_NUMBER=0
HUDSON_COOKIE=a1c7e405-925a-40bd-8910-fd4ba9d6887b
JENKINS_HOME=/var/lib/jenkins
DB_NAME=flaskapp
GIT_COMMIT=e721c4635cdf877eed2adeeae9363f38610664ab
STAGE_NAME=Check Environment
NODE_LABELS=built-in
JOURNAL_STREAM=8:168417
WORKSPACE_TMP=/var/lib/jenkins/workspace/FlaskRDS@tmp
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
DB_CREDENTIALS=****
CI=true
RUN_ARTIFACTS_DISPLAY_URL=http://54.86.181.124:8080/job/FlaskRDS/12/display/redirect?page=artifacts
GIT_BRANCH=origin/feature/pgrds
BUILD_ID=12
DB_CREDENTIALS_PSW=****
GIT_CREDENTIALS_USR=tomernos
_=/usr/bin/env
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Deploy)
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ echo 'Deploying the application...'
Deploying the application...
+ export DB_USER=flaskadmin
+ DB_USER=flaskadmin
+ export DB_PASSWORD=****
+ DB_PASSWORD=****
+ export DB_HOST=flask-app-postgres-db.cn4wyakgw2cz.us-east-1.rds.amazonaws.com
+ DB_HOST=flask-app-postgres-db.cn4wyakgw2cz.us-east-1.rds.amazonaws.com
+ export DB_NAME=flaskapp
+ DB_NAME=flaskapp
+ export DB_PORT=5432
+ DB_PORT=5432
+ docker-compose up -d
permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get "http://%2Fvar%2Frun%2Fdocker.sock/v1.24/containers/json?all=1&filters=%7B%22label%22%3A%7B%22com.docker.compose.config-hash%22%3Atrue%2C%22com.docker.compose.project%3Dflaskrds%22%3Atrue%7D%7D": dial unix /var/run/docker.sock: connect: permission denied
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Declarative: Post Actions)
[Pipeline] sh
+ echo 'Deployment failed'
Deployment failed
+ sudo docker-compose down
time="2024-08-29T10:42:22Z" level=warning msg="The \"DB_USER\" variable is not set. Defaulting to a blank string."
time="2024-08-29T10:42:22Z" level=warning msg="The \"DB_PASSWORD\" variable is not set. Defaulting to a blank string."
time="2024-08-29T10:42:22Z" level=warning msg="The \"DB_HOST\" variable is not set. Defaulting to a blank string."
time="2024-08-29T10:42:22Z" level=warning msg="The \"DB_NAME\" variable is not set. Defaulting to a blank string."
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
ERROR: script returned exit code 1
Finished: FAILURE